# Implementing a Cloud-Based Security Operation Center and Honeynet Within Azure

![Cloud Honeynet / SOC](https://i.imgur.com/8HKZq8c.png)

## Introduction to the Azure Honeynet and Security Operation Center

In this initiative, a compact honeynet was constructed within Azure, serving as a trap for cyber threats. This honeynet, along with various data sources, feeds into a Log Analytics workspace. This integration allows Microsoft Sentinel to utilize the data for crafting attack visualizations, initiating alerts, and logging incidents. Over a 48-hour period, I evaluated the security posture of a deliberately vulnerable setup, applying enhancements midway to bolster its defenses, and subsequently reassessed its security stance. We will explore the outcomes through the lens of the following metrics:

    Windows Security Events
    Linux Syslog Entries
    Alerts generated by Log Analytics
    Incidents reported by Microsoft Sentinel
    Network traffic anomalies detected in the honeynet

## Honeynet Configuration Pre and Post Security Enhancement

## Visual Representation of the Honeynet’s Architecture Before Security Adjustments
![Architecture Diagram](https://i.imgur.com/9TbD3VF.png)

## Visual Representation of the Honeynet’s Architecture After Security Adjustments
![Architecture Diagram](https://i.imgur.com/Mxx7LoA.png)

The architecture of the mini honeynet in Azure consists of the following components:

- Virtual Network (VNet)
- Network Security Group (NSG)
- Virtual Machines (2 windows, 1 linux)
- Log Analytics Workspace
- Azure Key Vault
- Azure Storage Account
- Microsoft Sentinel

In the initial deployment phase, the environment was entirely open to internet access. This configuration entailed that all resources, including Virtual Machines, were subjected to minimal security constraints. Specifically, Network Security Groups (NSGs) and the VMs' inherent firewall configurations were set to allow all inbound traffic, effectively leaving the system's public endpoints fully exposed without the implementation of Private Endpoints.

Upon transitioning to the post-enhancement phase, a comprehensive security overhaul was executed. The NSGs were reconfigured to enforce a strict policy, blocking all inbound traffic except for connections originating from the designated administrative workstation. This was a significant pivot from the previous setup, indicating a move towards a more secure environment. Additional security measures were applied across the network's resources, including the activation of built-in firewalls and the adoption of Private Endpoints. These changes collectively ensured a reduction in public exposure and a significant enhancement of the system's overall security posture.

## Attack Maps Before Hardening / Security Controls
![NSG Allowed Inbound Malicious Flows](https://i.imgur.com/Gz4Pj7D.png)<br>
![Linux Syslog Auth Failures](https://i.imgur.com/gOCn4Sa.png)<br>
![Windows RDP/SMB Auth Failures](https://i.imgur.com/1qWuYhW.png)<br>
![SQL Auth Failures](https://i.imgur.com/xRPeiP4.png)<br>

## Metrics Before Hardening / Security Controls

The following table shows the metrics we measured in our insecure environment for 24 hours:<br>
Start Time 2024-01-07 21:36:13<br>
Stop Time 2024-01-08 21:36:13

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 27951
| Syslog                   | 2908
| SecurityAlert            | 5
| SecurityIncident         | 243
| AzureNetworkAnalytics_CL | 3855

## Attack Maps Before Hardening / Security Controls

```All map queries actually returned no results due to no instances of malicious activity for the 24 hour period after hardening.```

## Metrics After Hardening / Security Controls

The following table shows the metrics we measured in our environment for another 24 hours, but after we have applied security controls:<br>
Start Time 2024-01-12 18:56:57<br>
Stop Time	2024-01-13 18:56:57

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 8534
| Syslog                   | 1
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Conclusion

This initiative involved constructing a honeynet within Azure, initially exposed to assess vulnerability, followed by the implementation of stringent security controls. The process entailed:

    Deployment in an exposed state to gauge baseline vulnerability.
    Application of security enhancements, including NSG restrictions and Private Endpoint utilization.

Outcomes highlighted a marked reduction in security incidents, validating the control measures' efficacy. The analysis underscores that outcomes can vary with usage intensity but emphasizes the effectiveness of strategic security implementations in mitigating cloud-based cyber risks.
